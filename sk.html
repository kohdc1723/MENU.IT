<script>
    // Upload Function
    // Save image in fire storage
    // Create document in Menus Collection including image url
    // Only logged-in users can upload
    var upload = document.getElementById('upload');
    upload.addEventListener('click', function () {
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // User is signed in.
                console.log(user.uid);

                // save file in fire storage 
                var file = document.querySelector('#menuimagefile').files[0];
                var storageRef = storage.ref();
                var storagePath = storageRef.child('menuimages/' + file.name);
                var uploadMenu = storagePath.put(file);

                uploadMenu.on('state_changed',
                    // when state changed
                    null,
                    // when error occured
                    (error) => {
                        console.error('Error: ', error);
                    },
                    // when succeed
                    () => {
                        // get image url and put it in the document attribute
                        uploadMenu.snapshot.ref.getDownloadURL().then((url) => {
                            console.log('updated path: ', url);
                            var querystring = new URLSearchParams(window.location.search);
                            var restaurantid = querystring.get('id');
                            var description = document.getElementById('description').value;
                            db.collection('Menus').add({
                                restaurantid: restaurantid,
                                description: description,
                                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                                uploader: user.uid,
                                imageURL: url
                            })
                                .then(() => {
                                    var restaurantid = querystring.get('id');
                                    alert('Uploaded!')
                                    window.location.href = `./restmain.html?id=${restaurantid}`;
                                }).catch((err) => {
                                    console.log(err);
                                })

                        });
                    }

                );

            } else {
                // No user is signed in.
                alert("Sign Up Before Upload!");
                window.location.href = "./login.html";
            }
        });
    })




            // Upload Function
        // Save image in fire storage
        // Create document in Menus Collection including image url
        // Only logged-in users can upload
        const db = firebase.firestore();
        document.querySelector('upload').addEventListener('click', function(){
        
        const 
        }
        
        var upload = document.getElementById('upload');
        upload.addEventListener('click', function () {
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    console.log(user.uid);

                    // save file in fire storage 
                    var file = document.querySelector('#menuimagefile').files[0];
                    var storageRef = storage.ref();
                    var storagePath = storageRef.child('menuimages/' + file.name);
                    var uploadMenu = storagePath.put(file);

                    uploadMenu.on('state_changed',
                        // when state changed
                        null,
                        // when error occured
                        (error) => {
                            console.error('Error: ', error);
                        },
                        // when succeed
                        () => {
                            // get image url and put it in the document attribute
                            uploadMenu.snapshot.ref.getDownloadURL().then((url) => {
                                console.log('updated path: ', url);
                                var querystring = new URLSearchParams(window.location.search);
                                var restaurantid = querystring.get('id');
                                var description = document.getElementById('description').value;
                                db.collection('Menus').add({
                                    restaurantid: restaurantid,
                                    description: description,
                                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                                    uploader: user.uid,
                                    imageURL: url
                                })
                                    .then(() => {
                                        var restaurantid = querystring.get('id');
                                        alert('Uploaded!')
                                        window.location.href = `./restmain.html?id=${restaurantid}`;
                                    }).catch((err) => {
                                        console.log(err);
                                    })

                            });
                        }
                        
                    );

                } else {
                    // No user is signed in.
                    alert("Sign Up Before Upload!");
                    window.location.href = "./login.html";
                }
            });
        })
</script>