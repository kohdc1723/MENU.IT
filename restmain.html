<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Restaurant A</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/line-awesome.min.css">
    <link rel="stylesheet" href="assets/css/content_blocks_modernstyle.css">
    <link rel="stylesheet" href="assets/css/Footer-Basic.css">
    <link rel="stylesheet" href="assets/css/Navigation-e-commerce.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Search.css">
    <link rel="stylesheet" href="assets/css/Soft-ui-Navbar.css">
    <link rel="stylesheet" href="assets/css/styles.css">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI.js"></script>

    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <style>
        /* --------------------- The modal stylesheet ---------------------- */
        #myImg {
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        #myImg:hover {
            opacity: 0.7;
        }

        .modal {
            display: none;
            /* Hidden by default */
            /*position: fixed;*/
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            padding-top: 100px;
            /* Location of the box */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.9);
            /* Black w/ opacity */
        }

        /* Modal Content (image) */
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
        }

        /* Caption of Modal Image */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 150px;
        }

        /* Add Animation */
        .modal-content,
        #caption {
            -webkit-animation-name: zoom;
            -webkit-animation-duration: 0.6s;
            animation-name: zoom;
            animation-duration: 0.6s;
        }

        @-webkit-keyframes zoom {
            from {
                -webkit-transform: scale(0)
            }

            to {
                -webkit-transform: scale(1)
            }
        }

        @keyframes zoom {
            from {
                transform: scale(0)
            }

            to {
                transform: scale(1)
            }
        }

        /* The Close Button */
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* 100% Image Width on Smaller Screens */
        @media only screen and (max-width: 700px) {
            .modal-content {
                width: 100%;
            }
        }

        button {
            border: none;
        }

        /* ----------------- clickable gallery style ----------------------- */
        #galleryimage:focus {
            border: 2px white solid;
        }

        #galleryimage:hover {
            opacity: 0.5;
        }
    </style>

</head>

<body style="border-style: none;border-color: var(--bs-yellow);">
    <nav class="navbar navbar-light navbar-expand-lg navigation-clean-search">
        <div class="container"><a class="navbar-brand" href="main.html"
                style="color: #ffa952;font-size: 25px;">Menu.It</a><button data-bs-toggle="collapse"
                class="navbar-toggler" data-bs-target="#navcol-2"
                style="background: #ffa952;color: var(--bs-white);"><span class="visually-hidden">Toggle
                    navigation</span><span class="navbar-toggler-icon"><svg xmlns="http://www.w3.org/2000/svg"
                        width="1em" height="1em" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z"
                            fill="currentColor"></path>
                        <path
                            d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z"
                            fill="currentColor"></path>
                        <path
                            d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z"
                            fill="currentColor"></path>
                    </svg></span></button>
            <div class="collapse navbar-collapse" id="navcol-2">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link active" href="main.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="favorites.html">Favorite</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
                </ul>

                <div class="col padMar" style="margin:8px 8px; padding:8px 18px">
                    <!--SEARCH BAR-->
                    <div class="col justify-content-end">
                        <div class="input-group">
                            <input class="form-control autocomplete" id="searchbox" type="text" placeholder="Search..."
                                style="height: 32px; border-color: #ffa952;">
                            <button class="btn btn-warning" type="button" id="searchbutton"
                                style="height: 32px;background: var(--bs-white);border-color: #ffa952;">
                                <i class="material-icons"
                                    style="color: rgb(255,169,82);border-color: var(--bs-white);">search</i></button>
                        </div>
                    </div>
                </div>

                <!--UPLOAD and PROFILE-->
                <a class="btn btn-light d-md-flex d-lg-flex justify-content-lg-center align-items-lg-center action-button"
                    role="button" href="profile.html" id="profile-name"
                    style="height: 32px;margin-left: 0px;background: #ffa952;font-size: 14px;width: 80px;"></a>
                <!-- <a class="btn d-md-flex d-lg-flex justify-content-lg-center action-button" role="button"
                    href="upload.html"
                    style="height: 32px; margin:8px 8px; padding: 8px 18px; background: #ffa952; font-size: 14px; width: 80px; align-items: center">Upload</a> -->
            </div>
        </div>
    </nav>

    <div class="container-fluid top-container">
        <div class="row" style="margin-top: 5%; margin-bottom: 5%;">
            <div class="col-12 col-md-6 col-xl-4 offset-xl-2">
                <div class="img-container"><img class="rounded" id="myImg"
                        style="width:100%; height:300px; object-fit: cover;" src="">
                    <div id="imgtext"></div>
                </div>
                <div id="galleryGroup"
                    style="display: flex; overflow: scroll; width: 100%; height: 40%; background-color: #ffa952;">
                    <template id="galleryTemplate">
                        <img src="" id="galleryimage" alt=""
                            style="padding-top: 10px; padding-left: 0; width: 50%; height: 90%; object-fit: cover; margin: 5px; cursor: pointer;"
                            tabindex="0" onclick="switchimage(this)">
                    </template>
                </div>
            </div>
            <div class="col-sm-12 col-md-6 col-xl-4 offset-xl-0">
                <h2 id="restoName" style="margin-top: 5px;"></h2>
                <h5>Last Validated on: <span id="datevalidated" class="fw-bold showdate">November 4, 2021</span></h5>
                <div class="text-right" style="margin-top: 3%;">
                    <button type="button" class="btn" onclick="" id="uploadimage"
                        style="background: #ffa952; color: var(--bs-white); margin-bottom: 5px; font-size: 14px;">Upload</button>
                    <button type="button" id="upload" class="btn" onclick="" id="favorite" href="./favorites.html"
                        style="background: #ffa952; color: var(--bs-white); margin-bottom: 5px; font-size: 14px;">Favorite</button>

                    <a><button type="button" id="validate" class="btn btn-sm validate_btn" onclick="updateValidate()"
                        style="background: #ffe79a; color: #ffa952; margin-bottom: 5px;">Validate</button></a>
                    <span>Count: <span id = "showcount">0</span></span>
                </div>
                <!--restaurant information-->
                <div class="col-sm-4" style="width: 100%; height: 60%; margin-top: 5%;">
                    <h5 style="padding: 8px; margin-top: 5px;">Restaurant Information</h5>
                    <div class="col-sm fs-4 pt-1"
                        style="border: solid 3px #ffa952; border-radius: 10px; margin-bottom:3%">
                        <div><i class="material-icons p-2" style="color: #ffa952;">call</i><span id="contact"
                                style="font-size: 20px;"></span></div>
                        <div><i class="material-icons p-2" style="color: #ffa952;">schedule</i><span id="hours"
                                style="font-size: 20px;"></span></div>
                        <div><i class="material-icons p-2" style="color: #ffa952;">sell</i><span id="price"
                                style="font-size: 20px;"></span></div>
                        <div><i class="material-icons p-2" style="color: #ffa952;">map</i><span id="location"
                                style="font-size: 20px;"></span></div>
                    </div>
                </div>
            </div>

            <!-- The Modal -->
            <div id="myModal" class="modal">
                <span class="close">&times;</span>
                <div id="modal-contents">
                    <img class="modal-content" id="img01">
                    <!-- <div id="caption">
                        <div style="padding: 5px; border-radius: 20px;">
                            <button type="button" class="btn btn-primary"
                                style="float: left; background-color: rgba(0, 0, 0, 0.9); border: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    fill="currentColor" class="bi bi-check-circle-fill"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                                Validate</button>
                            <span id="date" style="font-size: larger;">Nov 01 2021</span>
                            <button type="button" class="btn btn-primary"
                                style="float: right; background-color: rgba(0, 0, 0, 0.9); border: none;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                    fill="currentColor" class="bi bi-chat-text-fill"
                                    viewBox="0 0 16 16">
                                    <path
                                        d="M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234-.2.032-.352-.176-.273-.362.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7zM4.5 5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7zm0 2.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7zm0 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4z" />
                                </svg>
                                Comment</button>
                        </div>
                    </div> -->
                    <div id="buttons"></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer-basic" style="margin-bottom: 3%; height: 85px; border-top: 1px solid #E8E8E8">
        <ul class="list-inline">
            <li class="list-inline-item" style="font-size: 14px;"><a href="#">Home</a></li>
            <li class="list-inline-item"><a href="#" style="font-size: 14px;">Features</a></li>
            <li class="list-inline-item"><a href="#" style="font-size: 14px;">FAQs</a></li>
            <li class="list-inline-item"><a href="#" style="font-size: 14px;">About</a></li>
            <li class="list-inline-item"></li>
        </ul>
        <p class="copyright">Menu.It © 2021</p>
    </footer>

    <script>
        // Change restautant information and restaurant name using querystring data
        var querystring = new URLSearchParams(window.location.search);
        db.collection('Restaurants').doc(querystring.get('id')).get().then((result) => {
            document.getElementById('restoName').innerHTML = result.data().restaurantname;
            document.getElementById('contact').innerHTML = result.data().phone;
            document.getElementById('hours').innerHTML = result.data().hours;
            document.getElementById('location').innerHTML = result.data().location;
            document.getElementById('price').innerHTML = result.data().pricepoint;
        })

        // Clickable upload button, redirect to upload.html corresponding to the restaurantid
        var upload = document.getElementById('uploadimage');
        upload.addEventListener('click', () => {
            var querystring = new URLSearchParams(window.location.search);
            console.log(querystring.get('id'));
            window.location.href = `./upload.html?id=${querystring.get('id')}`;
        })

        // Search Function
        var searchbutton = document.getElementById('searchbutton');
        searchbutton.addEventListener('click', () => {
            var searchinput = document.getElementById('searchbox').value;
            db.collection('Restaurants').where('restaurantname', '==', searchinput).get()
                .then((result) => {
                    result.forEach((doc) => {
                        var restaurantid = doc.id;
                        window.location.href = `./restmain.html?id=${restaurantid}`;
                    })
                })
                .catch(() => {
                    alert('Cannot Find Restaurant');
                })
        })

        // Gallery Display
        function displayGallery() {
            var galleryTemplate = document.getElementById('galleryTemplate');
            var galleryGroup = document.getElementById('galleryGroup');
            var querystring = new URLSearchParams(window.location.search);
            var restaurantid = querystring.get('id');
            // declare array for timestamp sorting
            var urlarray = new Array();
            db.collection('Menus').where('restaurantid', '==', restaurantid).onSnapshot((imageload) => {
                imageload.forEach((doc) => {
                    // array control
                    var i = 0;
                    // reading imageURL and timestamp from documents
                    var menuimageurl = doc.data().imageURL;
                    var menutime = doc.data().timestamp;
                    // add url and timestamp in the array => creates 2D array
                    urlarray.push([menuimageurl, menutime]);
                    // sort array by timestamp
                    urlarray.sort(function (a, b) {
                        return b[1].seconds - a[1].seconds;
                    })
                    // increment control
                    i++;
                })
                // populate images in order of timestamp
                for (var i = 0; i < urlarray.length; i++) {
                    var testGallery = galleryTemplate.content.cloneNode(true);
                    testGallery.querySelector('img').src = urlarray[i][0];
                    galleryGroup.appendChild(testGallery);
                }
                // show first image as default in a big image field
                document.getElementById('myImg').src = urlarray[0][0];
            })
        }
        displayGallery();

        // Clickable Gallery
        function switchimage(img) {
            document.getElementById('myImg').src = img.src;
        }

    </script>
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the image and insert it inside the modal - use its "alt" text as a caption
        var img = document.getElementById("myImg");
        var modalImg = document.getElementById("img01");
        var captionText = document.getElementById("caption");
        var buttons = document.getElementById("buttons");
        img.onclick = function () {
            modal.style.display = "block";
            modalImg.src = this.src;
            captionText.style.display = "block";
            //captionText.innerHTML = this.alt;
            buttons.style.display = "block";
        }

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

    </script>

    <!--validate button functions!-->
    <script>
        //calls 2 other functions when validate is clicked
        function updateValidate() {
            clickedValidate();
            incrementValidate();
        }

        //increments
        function incrementValidate() {
            //gets the main image's src data
            let mainImgSrc = document.getElementById("myImg").getAttribute("src");
            console.log(mainImgSrc);

            db.collection("Menus").get().then((snapshot) => {
                snapshot.forEach(doc => {
                    var query = doc.data().imageURL
                    // console.log(doc.id) //gets the document ID of where the URL is

                    //if the mainimgsrc is in the query, then say it matches!
                    if (mainImgSrc == query) {
                        console.log("found one!");
                        var URLindocumentID = doc.id;

                        console.log(URLindocumentID); //provides the document ID with the URL field

                        var updateTimeStamp = db.collection("Menus").doc(URLindocumentID);

                        updateTimeStamp.set({
                            validatecount: firebase.firestore.FieldValue.increment(1),
                        }, { merge: true });

                        updateTimeStamp.update({
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        })

                        updateTimeStamp
                            .onSnapshot(doc => {
                                //gets timestamp of the specific documentID
                                var theTime = doc.data().timestamp;
                                console.log(theTime.toDate());
                                // const validatedDate = theTime.toDate().toDateString(); //if ONLY WANT THE DATE

                                document.getElementById("datevalidated").innerHTML = theTime.toDate();
                            })

                        updateTimeStamp
                        .onSnapshot(doc => {
                            // console.log(doc.data().validatecount);
                            document.getElementById("showcount").innerHTML = doc.data().validatecount;
                        })
                    }
                })

            })
        }

        //changes the color
        function clickedValidate() {
            //changed background color and text color
            document.querySelector('#validate').style.backgroundColor = '#ef5a5a';
            document.getElementById("validate").style.color = 'white';
            //text changes to "Validated"
            document.getElementById("validate").innerHTML = "Validated";
        }
    </script>

    <script>
        function showValidDate(){
            var querystring = new URLSearchParams(window.location.search);

            db.collection('Menus').where('restaurantid', '==', restaurantid).onSnapshot((imageload) => {
                imageload.forEach((doc) => {


        }
    </script>
    <script src="/assets/js/Image-Tab-Gallery-Horizontal.js"></script>
    <script id="bs-live-reload" data-sseport="64275" data-lastchange="1636052765041" src="/js/livereload.js"></script>

</body>

</html>